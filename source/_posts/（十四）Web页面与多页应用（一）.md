---
title: （十四）Web页面与多页应用（一）
date: 2020-01-11 18:39:34
tags: JavaScript
---
# Web页面与多页应用(一)

## Web页面的运行环境-浏览器

我们需要关注的浏览器部分：

+ 用户界面：包括地址栏、按钮、菜单等。
+ 用户界面后端：用于绘制基本的窗口小部件。
+ 网络：用于网络调用，比如发送HTTP请求。
+ 浏览器引擎：在用户界面和渲染引擎之间传送指令。

### 渲染引擎

渲染引擎是浏览器最核心的组成部分，也就是我们常说的“浏览器内核”，它负责显示页面内容。

1.引擎分类

不同的浏览器采用不同的渲染引擎解析和渲染，这种差异会产生兼容性问题。

主流浏览器内核：

+ Chrome：Webkit
+ IE：Trident
+ Edge：Webkit
+ FireFox：Gecko
+ Opera：Webkit
+ Safari：Webkit

2.渲染流程

1) 构建DOM（Document Object Model）树

影响DOM树的生成时间的因素有两个：

+ 元素数量。
+ 元素的嵌套关系。

两个页面拥有相同数量的元素，但是嵌套关系不一样的话，DOM树的渲染时间也是不同的。

2) 构建CSSOM（Cascade Style Sheet Object Model）树。

3) 构建渲染树

最后将两棵树合并，形成渲染树。

有两个因素会影响构建渲染树的时间：

+ 样式匹配方式。
+ 布局与绘制的关系。

浏览器将样式附着到DOM树上的时候，是从右向左匹配的，因为从左到右进行匹配时，会出现大量的回溯操作。

渲染页面的大致流程：

1) 解析HTML生成DOM树。
2) 解析CSS生成CSSOM树。
3) 将DOM树与CSSOM树合并成一个渲染树。
4) 根据渲染树来进行布局。
5) 对渲染树上的节点进行绘制。

如何写出高性能代码：

+ 避免编写复杂的DOM解构，减少DOM层级。
+ 避免编写复杂的CSS样式。
+ 避免在选择器右边使用通用选择器。
+ 修改样式的时候避免引起重新布局。

### JavaScript引擎

JS引擎负责解析和执行JS代码。

浏览器给JS引擎两大功能：DOM和BOM。

这样JS引擎不仅能运行JS代码还能操作浏览器窗口和内容树。

1) 串行

根据上面描述，JS引擎与渲染引擎就会产生阻塞。比如死锁或者惊群。

解决办法是将script标签放在body底部，这样渲染完成后JS引擎才会运行。

2) 异步

script标签有两个属性可以改变浏览器的工作顺序。

+ defer：是js操作延后，html解析完成后再执行。
+ async：可以并发请求，但是执行js的时候依然会与渲染引擎阻塞。

3) 版本

主流浏览器的JS引擎：

+ Chrome：V8
+ IE：Chakra
+ Edge：Chakra
+ FireFox：JaegerMonkey
+ Opera：Carakan
+ Safari：Nitro

### 数据持久层

出于安全考虑，在默认情况下无法通过浏览器来直接读写磁盘中的文件。只能通过浏览器的一些API来访问磁盘的数据，并且用户有权拒绝浏览器执行这些操作。

浏览器提供的集中存储数据的方式：

+ Cookie：服务器端可以通过请求头向浏览器传入Cookie，如果设置了HttpOnly属性，则无法通过JS脚本修改。
+ LocalStorage和SessionStorage。H5的新特性，可以通过这两个API向客户端存储键值对。区别就是前者关闭浏览器还存在，后者关闭浏览器后失效。
+ WebSQL和IndexedDB。前者可以通过SQL语句操作，后者是NoSQL数据库，通过API操作。

上述几种存储方式存在域隔离，也就是说不同域相互不能访问。

